{% extends 'base.html' %}
{% block content %}
<div class="row">
  <div class="col-md-8">
    <div class="infocard mb-3">
      <form method="post" action="{{ url_for('feed.new_post') }}">
        <label class="form-label fw-semibold">Share an update</label>
        <textarea class="form-control" name="content" rows="3" placeholder="What's happening?" required></textarea>
        <div class="text-end mt-2">
          <button class="btn btn-sm btn-primary">Post</button>
        </div>
      </form>
    </div>

    {% for post in posts %}
      <div class="infocard mb-3">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <a class="fw-semibold" href="{{ url_for('profile.view_profile', username=post.author.username) }}">@{{ post.author.username }}</a>
            <span class="text-muted small"> • {{ post.timestamp.strftime('%Y-%m-%d %H:%M') }}</span>
          </div>
          <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('feed.like', post_id=post.id) }}">♥ {{ post.likes|length }}</a>
        </div>
        <div class="mt-2" style="white-space: pre-wrap;">{{ post.content | e }}</div>
        <div class="mt-3">
          <form method="post" action="{{ url_for('feed.comment', post_id=post.id) }}">
            <div class="input-group">
              <input class="form-control" name="comment" placeholder="Write a comment" required>
              <button class="btn btn-outline-primary btn-sm">Reply</button>
            </div>
          </form>
          {% if post.comments %}
          <div class="mt-2 ps-2 border-start">
            {% for c in post.comments %}
              <div class="small mb-1">
                <a href="{{ url_for('profile.view_profile', username=c.user.username) }}">@{{ c.user.username }}</a>:
                {{ c.content | e }}
                <span class="text-muted"> • {{ c.timestamp.strftime('%Y-%m-%d %H:%M') }}</span>
              </div>
            {% endfor %}
          </div>
          {% endif %}
        </div>
      </div>
    {% else %}
      <div class="infocard">Your feed is quiet. Find friends to get started.</div>
    {% endfor %}
  </div>

  <div class="col-md-4 d-none d-md-block">
    <div class="infocard">
      <h6>Friend Activity</h6>
      <div class="small text-muted">Recent posts from your circle appear here.</div>
    </div>
  </div>
</div>
{% endblock %}
